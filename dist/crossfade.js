!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery||window.Zepto)}(function(t){"use strict";function i(i,s){var e=this;if(s.debug===!0,e.el=t(i).css({position:"relative"}),e.options=s,e.width=e.el.width(),e.height=e.el.height(),e.canvas=t("<canvas>").appendTo(e.el),e.paintbrush=e.canvas[0].getContext("2d"),e.options.backgroundPosition){var o=e.options.backgroundPosition.split(" ");e.options.backgroundPositionX=o[0],e.options.backgroundPositionY=o[1],delete e.options.backgroundPosition}e.getSources(function(){t(window).on("scroll",t.proxy(e.onScroll,e)),t(window).on("resize",t.proxy(e.onResize,e)),e.resize(),t(window).trigger("scroll")})}i.prototype.getSources=function(i){var s=this.options.image||this.el.data("image-start"),e=this.options.imageBlurred||this.el.data("image-end");if(!s||!e)throw new Error("Crossfade requires two images");this.start=t("<img>").attr({src:s}),this.end=t("<img>").attr({src:e});for(var o=[this.start,this.end],n=o.length,h=0;h<o.length;h++)o[h].on("load",function(){n--,0===n&&"function"==typeof i&&i()}),o[h].prop("complete")&&o[h].trigger("load")},i.prototype.resize=function(){this.needsResize=!1,this.canvas[0].width=this.width,this.canvas[0].height=this.height,this.canvas.css({position:"absolute",top:"0",left:"0",width:this.width,height:this.height})},i.prototype.draw=function(){var t;this.needsResize&&this.resize(),t=this.getDrawDimensions(this.start[0].width,this.start[0].height,this.width,this.height),this.paintbrush.drawImage(this.start[0],t.offset.x,t.offset.y,t.width,t.height),this.paintbrush.globalAlpha=this.visibility,this.paintbrush.drawImage(this.end[0],t.offset.x,t.offset.y,t.width,t.height),this.paintbrush.globalAlpha=1,this.ticking=!1},i.prototype.getDrawDimensions=function(t,i,s,e){var o={},n=i/t,h=e/s;if(h>n?(o.width=parseInt(e/n),o.height=parseInt(e)):(o.width=parseInt(s),o.height=parseInt(s*n)),o.offset={x:0,y:0},this.options.backgroundPositionY&&o.height>e)switch(this.options.backgroundPositionY){case"center":o.offset.y=(o.height-e)/-2;break;case"bottom":o.offset.y=-1*(o.height-e)}if(this.options.backgroundPositionX&&o.width>s)switch(this.options.backgroundPositionX){case"center":o.offset.x=(o.width-s)/-2;break;case"right":o.offset.x=-1*(o.width-s)}return this.options.debug===!0,o},i.prototype.onScroll=function(){var i,s=t(window).scrollTop(),e=this.el.offset().top,o=this.el.height();i=e>s?0:s>e+o?1:(s-e)/(o*this.options.distance),this.visibility=i,this.options.debug===!0,this.requestTick()},i.prototype.onResize=function(){this.needsResize=!0,this.width=this.el.width(),this.height=this.el.height(),this.requestTick()},i.prototype.requestTick=function(){var t=this;this.ticking||requestAnimationFrame(function(){t.draw()}),this.ticking=!0},t.extend(t.fn,{crossfade:function(s){var e=t.extend({},t.fn.crossfade.defaults,s);return this.each(function(){return t(this).data("crossfade",new i(this,e)),this})}}),t.fn.crossfade.defaults={}});